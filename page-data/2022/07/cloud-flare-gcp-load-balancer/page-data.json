{"componentChunkName":"component---src-templates-blog-post-js","path":"/2022/07/cloud-flare-gcp-load-balancer/","result":{"data":{"site":{"siteMetadata":{"title":"W.S. Peng 部落格"}},"markdownRemark":{"id":"6e25d048-51a0-5171-ab77-bf6aa7ec2b25","excerpt":"在多數的情境下，使用 GCP 做為網頁伺服器時，都會使用 GCP 的 CDN 解決方案，但當遇到動態網頁或是其他非靜態網頁時，GCP 的 CDN 並不支援這一類的方式的快取；此時就可以使用 CloudFlare 做為 CDN，使用此方式需注意內容如果有變更，需在 CloudFlare console 或是以 API…","html":"<p>在多數的情境下，使用 GCP 做為網頁伺服器時，都會使用 GCP 的 CDN 解決方案，但當遇到動態網頁或是其他非靜態網頁時，GCP 的 CDN 並不支援這一類的方式的快取；此時就可以使用 CloudFlare 做為 CDN，使用此方式需注意內容如果有變更，需在 CloudFlare console 或是以 API purch CDN cache。</p>\n<h2>GCP 設定 HTTP(S) Load Balancer</h2>\n<ol>\n<li>\n<p>建立一台 VM</p>\n</li>\n<li>\n<p>建立 <a href=\"https://console.cloud.google.com/compute/instanceGroups/add\">Instance Group</a></p>\n</li>\n<li>\n<p>新增 <a href=\"https://console.cloud.google.com/net-services/loadbalancing/add\">HTTP(S) Load Balancer</a></p>\n<ol>\n<li>\n<p>選擇 HTTP(S) Load Balancer <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b776fbac0da94aaf41e5f906f8c7c54/460fa/gcp-add-load-balancer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.78481012658228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAnUlEQVQY00XPWQ7DIAwEUO5/1EpNiCngbeyKLO0TXxYaj8vrTa0zixIdRC0WXNzdzOLhJzMDkBEsXvqQiDSzT1tYRNTPgNj3ehDpzYDovddamdnU1LyMOTJzzrlt25W6gjPdnYgy866BtZyIri7AeqU1Wg3NiZqZ5QPAXg8W/U0iYozJLL9JEZZ1CjDF1fzZAwf6kMmKP1f1yY7n1xd06iWFvGoSvwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GCP Load Balancer\"\n        title=\"GCP Load Balancer\"\n        src=\"/static/7b776fbac0da94aaf41e5f906f8c7c54/f058b/gcp-add-load-balancer.png\"\n        srcset=\"/static/7b776fbac0da94aaf41e5f906f8c7c54/c26ae/gcp-add-load-balancer.png 158w,\n/static/7b776fbac0da94aaf41e5f906f8c7c54/6bdcf/gcp-add-load-balancer.png 315w,\n/static/7b776fbac0da94aaf41e5f906f8c7c54/f058b/gcp-add-load-balancer.png 630w,\n/static/7b776fbac0da94aaf41e5f906f8c7c54/40601/gcp-add-load-balancer.png 945w,\n/static/7b776fbac0da94aaf41e5f906f8c7c54/78612/gcp-add-load-balancer.png 1260w,\n/static/7b776fbac0da94aaf41e5f906f8c7c54/460fa/gcp-add-load-balancer.png 1910w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>依需求選擇，此次選擇 Regional HTTP(S) Load Balancer <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/97a88cf0aa2744b87cf3c14787cb20a5/ae77d/gcp-add-load-balancer-02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABAElEQVQoz42RQU7EMAxFe/+LcAlWnIAFgu20tEnTdFrHTZvYSWrUGZAQKoi3sayvZ33JVW/GYQQ7gkNPKW9bBIBpmgCAiPiLfEYFPl+BnM8xSeSyLEiREjNRZOZ0I+ckZ1RMhA6IooiUUgYzaKV702vdIyIzxU9CKeWnnHJGxEgkIimXTpn2/aBpmrputFJ+WUII27adyMyMiN77u2yM1VpZa9d1RYcpZfmdKsboHCDirXZWXXe51G3bDtb6ZYkhHKdXv+/7iUxMR6t1I6Jcdgezm0djjNbq5fWtbjsROTUP+T7uaeTy8GienifZj0/Y62yn+a/a35dS9taShST/4wPe5Aq2fRSwJAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GCP Load Balancer\"\n        title=\"GCP Load Balancer\"\n        src=\"/static/97a88cf0aa2744b87cf3c14787cb20a5/f058b/gcp-add-load-balancer-02.png\"\n        srcset=\"/static/97a88cf0aa2744b87cf3c14787cb20a5/c26ae/gcp-add-load-balancer-02.png 158w,\n/static/97a88cf0aa2744b87cf3c14787cb20a5/6bdcf/gcp-add-load-balancer-02.png 315w,\n/static/97a88cf0aa2744b87cf3c14787cb20a5/f058b/gcp-add-load-balancer-02.png 630w,\n/static/97a88cf0aa2744b87cf3c14787cb20a5/40601/gcp-add-load-balancer-02.png 945w,\n/static/97a88cf0aa2744b87cf3c14787cb20a5/ae77d/gcp-add-load-balancer-02.png 1111w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>設定 Load Balancer Front IP 與對內網路 <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b6750959aa74b50bf6d0bcbba3541e60/4352a/gcp-save-load-balancer.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABNElEQVQoz42SC27DIAyGe/877Qg7R5eIJuFl/GYidGsrTVo/EELAb/+2uIS93A7YY0PS/YhHjLmUUmuMKZ+kNDZm5u72yiUV2mNldbW+bXuM0cx774hIRMuyXK9fy7KkEwBAov7DhQhzju4jcLiFCpWZhTnnhISttXqChCLiPuLOdYhFBABU1d33mEuFUqDUBo2YNcYjhJBSYhYzN/PWkJnvYqh12zZsTayvW1vDHvbc2FF6I4PGDWVmm8w0d7Gqykl3jzGu61pruV+7327HkcrwoDYnAIzHU/xbvbuf1Y5hZuPEPKU0CkZ8bvIj87O4v+LuOWdiUTURFVEVZRou3hKXUhDJ1KdnESOS6et/sZrLqZkQG7POj/BoWP8TdySFpkjmrzw+CQC4map/fKZrqN21v8c3JibAKj7T75gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GCP Create Load Balancer\"\n        title=\"GCP Create Load Balancer\"\n        src=\"/static/b6750959aa74b50bf6d0bcbba3541e60/f058b/gcp-save-load-balancer.png\"\n        srcset=\"/static/b6750959aa74b50bf6d0bcbba3541e60/c26ae/gcp-save-load-balancer.png 158w,\n/static/b6750959aa74b50bf6d0bcbba3541e60/6bdcf/gcp-save-load-balancer.png 315w,\n/static/b6750959aa74b50bf6d0bcbba3541e60/f058b/gcp-save-load-balancer.png 630w,\n/static/b6750959aa74b50bf6d0bcbba3541e60/40601/gcp-save-load-balancer.png 945w,\n/static/b6750959aa74b50bf6d0bcbba3541e60/78612/gcp-save-load-balancer.png 1260w,\n/static/b6750959aa74b50bf6d0bcbba3541e60/4352a/gcp-save-load-balancer.png 1364w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>設定 Backend Service</p>\n<ol>\n<li>\n<p>Backend service 的 Instance Group 選擇前一步驟所設定的 <code class=\"language-text\">load-balancer-lab</code>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f0e96fd68be7ecbfd7925217bc55b1f/c8ad9/gcp-load-balancer-backed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABbklEQVQoz3WRy07rMBCG+/hsz7pSaezY4xlfiniFszgLThvUbnkCEEVNkzgXp0F2S0Egvo03/vX9MzNbZjnPRZbFh3POGAMARCQiZ60Q4rEo2rb13o/jGBJ933ddN03TTCExzqQEa63WWinFGJ/PFxnjRHqZZZui6Puha9sxEUIYEjGsiXiynZNCCCGVkAoUAeDilj08/K+qqkt477s+MoQQwxjNgnEuhEBETRqRJJBC45wDgKIoxhCFVR0ZQmiapq7rS20u1GLJBCBpB8ooRAAEUIiUZWyz2Vx7TtN0Op1CCOM4xrAxZr7IGcsR0RhjrTUfWGullOv1+ng8Nk1zXVhIndPMxtz8yXOhbPr9FeeclHK73Xrv96+vh0RZlofD4ZyfWWvv75xz9ier1UpKudvt0rD19MEpcan9Q/nd/Pz8UpblMAxp0/HIl5m11vYXPs3VsfX+6vw0E9FvYeccKvj773H39Lbf78+Br83fAfMcDJdTUZbXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GCP Load Balancer Backend\"\n        title=\"GCP Load Balancer Backend\"\n        src=\"/static/0f0e96fd68be7ecbfd7925217bc55b1f/f058b/gcp-load-balancer-backed.png\"\n        srcset=\"/static/0f0e96fd68be7ecbfd7925217bc55b1f/c26ae/gcp-load-balancer-backed.png 158w,\n/static/0f0e96fd68be7ecbfd7925217bc55b1f/6bdcf/gcp-load-balancer-backed.png 315w,\n/static/0f0e96fd68be7ecbfd7925217bc55b1f/f058b/gcp-load-balancer-backed.png 630w,\n/static/0f0e96fd68be7ecbfd7925217bc55b1f/40601/gcp-load-balancer-backed.png 945w,\n/static/0f0e96fd68be7ecbfd7925217bc55b1f/78612/gcp-load-balancer-backed.png 1260w,\n/static/0f0e96fd68be7ecbfd7925217bc55b1f/c8ad9/gcp-load-balancer-backed.png 1564w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</li>\n<li>\n<p>Health Check 如果已有 http 80，可直接使用，如果沒有，可自行建一個</p>\n</li>\n</ol>\n</li>\n<li>\n<p>按下 Create 按鈕完成建立 Load Balancer</p>\n</li>\n</ol>\n</li>\n</ol>\n<h2>CloudFlare 設定 DNS 與 CDN</h2>\n<p>新增 DNS Record A，IP Address 設定為 GCP Load Balancer 的 IP Adress。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/48a773ea0f4a39802c91adaa90c2c64f/9efb3/cloudflare-cdn-record-a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.37974683544304%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAwUlEQVQY022QwU4DMQxE9/9/q0ckDj1x4AhS26VsIHYSz8QJ2g3tglRfbNnyjJ+n5fxWJPTee2t9pN/iX4weSQAkzYzklOHV9wWSMUZ3J+m+Ddpjud77dAlFEqyu6sP3O0ZVVREAwxRs8xdIvF/tHLAvRzUCfpN2d1FR1VJKSilGIew0h6eX+fP6cTienl+XO8WkGeO8G1vLOYcliIiZpZTIihxbXSFbGyx357RB951qO1m2l6DWyjUqsL4KoP/h/wHrOl/KQz06HwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CloudFlare CDN\"\n        title=\"CloudFlare CDN\"\n        src=\"/static/48a773ea0f4a39802c91adaa90c2c64f/f058b/cloudflare-cdn-record-a.png\"\n        srcset=\"/static/48a773ea0f4a39802c91adaa90c2c64f/c26ae/cloudflare-cdn-record-a.png 158w,\n/static/48a773ea0f4a39802c91adaa90c2c64f/6bdcf/cloudflare-cdn-record-a.png 315w,\n/static/48a773ea0f4a39802c91adaa90c2c64f/f058b/cloudflare-cdn-record-a.png 630w,\n/static/48a773ea0f4a39802c91adaa90c2c64f/40601/cloudflare-cdn-record-a.png 945w,\n/static/48a773ea0f4a39802c91adaa90c2c64f/78612/cloudflare-cdn-record-a.png 1260w,\n/static/48a773ea0f4a39802c91adaa90c2c64f/9efb3/cloudflare-cdn-record-a.png 1894w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>參考資料</h2>\n<ul>\n<li><a href=\"https://cloud.google.com/load-balancing/docs/https\">External HTTP(S) Load Balancing overview  |  Google Cloud</a></li>\n<li><a href=\"https://blog.cloud-ace.tw/networking-website/load-balance/gcp-https-load-balancer/\">GCP HTTP(S) Load Balancer 負載平衡依網址分流教學 - Cloud Ace</a></li>\n<li><a href=\"https://cloud.google.com/cdn/docs/caching#non-cacheable_content\">Caching overview  |  Cloud CDN  |  Google Cloud</a></li>\n</ul>","frontmatter":{"title":"CloudFlare CDN 與 GCP Load Balancer 設定教學","date":"July 13, 2022","description":null}},"previous":{"fields":{"slug":"/2022/05/02-get-and-compile-code-windows/"},"frontmatter":{"title":"Chromium 瀏覽器內核原理（02）-取得與編譯程式碼"}},"next":{"fields":{"slug":"/2022/07/chromium-mojo-and-ipc/"},"frontmatter":{"title":"Chromium Mojo & IPC"}}},"pageContext":{"id":"6e25d048-51a0-5171-ab77-bf6aa7ec2b25","previousPostId":"fde08981-a6b9-5c94-854b-8184d7f5ede1","nextPostId":"35183208-b423-5872-a4ab-576a7b28e4d7"}},"staticQueryHashes":["2841359383","3257411868"]}